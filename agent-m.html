<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Host - Model Context Protocol Client</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .main-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .connection-panel {
            padding: 30px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-bottom: 1px solid #dee2e6;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        input[type="url"], input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        input[type="url"]:focus, input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .status-bar {
            padding: 16px 30px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-connecting { background: #ffc107; }
        .status-ready { background: #28a745; }
        .status-failed { background: #dc3545; }
        .status-disconnected { background: #6c757d; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .content-area {
            padding: 30px;
            min-height: 400px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
            font-weight: 600;
        }

        .tab:hover {
            background: #f8f9fa;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .tool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .tool-card {
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            background: #f8f9fa;
            transition: all 0.2s ease;
        }

        .tool-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .tool-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 12px;
        }

        .tool-name {
            font-size: 18px;
            font-weight: 700;
            color: #495057;
        }

        .tool-description {
            color: #6c757d;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .tool-inputs {
            margin-bottom: 16px;
        }

        .tool-input {
            margin-bottom: 12px;
        }

        .tool-input input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
        }

        .execute-btn {
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .execute-btn:hover {
            background: #218838;
        }

        .result-area {
            margin-top: 16px;
            padding: 12px;
            background: #e9ecef;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state h3 {
            margin-bottom: 12px;
            color: #495057;
        }

        .log-container {
            background: #1a1a1a;
            color: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 4px 0;
        }

        .log-timestamp {
            color: #6c757d;
            margin-right: 8px;
        }

        .log-level-info { color: #17a2b8; }
        .log-level-warn { color: #ffc107; }
        .log-level-error { color: #dc3545; }
        .log-level-debug { color: #6f42c1; }

        .resource-list {
            margin-top: 20px;
        }

        .resource-item {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            background: #f8f9fa;
        }

        .resource-uri {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }

        .resource-description {
            color: #6c757d;
            margin-bottom: 12px;
        }

        .read-resource-btn {
            background: #17a2b8;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .read-resource-btn:hover {
            background: #138496;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ¦‘ MCP Host</h1>
            <p>Model Context Protocol Client Interface</p>
        </div>

        <div class="main-card">
            <div class="connection-panel">
                <div class="form-group">
                    <label for="serverUrl">MCP Server URL</label>
                    <input type="url" id="serverUrl" placeholder="https://your-mcp-server.com/sse" 
                           value="http://localhost:5101/sse">
                </div>
                <div class="form-group">
                    <label for="clientName">Client Name (Optional)</label>
                    <input type="text" id="clientName" placeholder="My MCP Client" value="Web MCP Host">
                </div>
                <div class="button-group">
                    <button class="btn-primary" onclick="connectToServer()">Connect</button>
                    <button class="btn-secondary" onclick="disconnectFromServer()">Disconnect</button>
                </div>
            </div>

            <div class="status-bar">
                <div class="status-indicator status-disconnected" id="statusIndicator"></div>
                <span id="statusText">Disconnected</span>
            </div>

            <div class="content-area">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('tools')">Tools</div>
                    <div class="tab" onclick="switchTab('resources')">Resources</div>
                    <div class="tab" onclick="switchTab('prompts')">Prompts</div>
                    <div class="tab" onclick="switchTab('logs')">Debug Logs</div>
                </div>

                <div id="tools-content" class="tab-content active">
                    <div class="empty-state">
                        <h3>No Tools Available</h3>
                        <p>Connect to an MCP server to see available tools</p>
                    </div>
                </div>

                <div id="resources-content" class="tab-content">
                    <div class="empty-state">
                        <h3>No Resources Available</h3>
                        <p>Connect to an MCP server to see available resources</p>
                    </div>
                </div>

                <div id="prompts-content" class="tab-content">
                    <div class="empty-state">
                        <h3>No Prompts Available</h3>
                        <p>Connect to an MCP server to see available prompts</p>
                    </div>
                </div>

                <div id="logs-content" class="tab-content">
                    <div class="log-container" id="logContainer">
                        <div class="log-entry">
                            <span class="log-timestamp">[Ready]</span>
                            <span class="log-level-info">MCP Host initialized</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // MCP Host State Management
        let mcpConnection = null;
        let connectionState = 'disconnected';
        let tools = [];
        let resources = [];
        let prompts = [];
        let logs = [];

        // Logging function
        function addLog(level, message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push({ timestamp, level, message });
            
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level-${level}">[${level.toUpperCase()}] ${message}</span>
            `;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Connection status management
        function updateStatus(state, message) {
            connectionState = state;
            const indicator = document.getElementById('statusIndicator');
            const text = document.getElementById('statusText');
            
            indicator.className = `status-indicator status-${state}`;
            text.textContent = message || state;
            
            addLog('info', `Status: ${message || state}`);
        }

        // Tab switching
        function switchTab(tabName) {
            // Remove active class from all tabs and content
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab and content
            event.target.classList.add('active');
            document.getElementById(`${tabName}-content`).classList.add('active');
        }

        // Mock MCP Connection (simulating the use-mcp library behavior)
        class MockMCPConnection {
            constructor(url, options = {}) {
                this.url = url;
                this.options = options;
                this.state = 'disconnected';
                this.tools = [];
                this.resources = [];
                this.prompts = [];
                this.eventSource = null;
            }

            async connect() {
                try {
                    updateStatus('connecting', 'Connecting to server...');
                    addLog('info', `Attempting to connect to ${this.url}`);
                    
                    // Check for HTTPS/HTTP mismatch
                    const isHttps = window.location.protocol === 'https:';
                    const serverIsHttps = this.url.startsWith('https:');
                    
                    if (!isHttps && serverIsHttps) {
                        throw new Error('Cannot connect to HTTPS server from HTTP page. Either use HTTPS for this page or an HTTP server.');
                    }
                    
                    // First try to ping the server with fetch to check availability
                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 5000);
                        
                        const response = await fetch(this.url, {
                            method: 'HEAD',
                            signal: controller.signal,
                            mode: 'cors'
                        });
                        
                        clearTimeout(timeoutId);
                        addLog('info', `Server responded with status: ${response.status}`);
                    } catch (fetchError) {
                        addLog('warn', `Server check failed: ${fetchError.message}`);
                        // Continue anyway, might be a CORS issue but SSE could still work
                    }
                    
                    // Try to establish EventSource connection
                    this.eventSource = new EventSource(this.url);
                    
                    // Set up timeout for connection
                    const connectionTimeout = setTimeout(() => {
                        if (this.eventSource && this.eventSource.readyState !== EventSource.OPEN) {
                            addLog('error', 'Connection timeout');
                            this.eventSource.close();
                            updateStatus('failed', 'Connection timeout');
                        }
                    }, 10000);
                    
                    this.eventSource.onopen = () => {
                        clearTimeout(connectionTimeout);
                        addLog('info', 'EventSource connection established');
                        updateStatus('loading', 'Loading server capabilities...');
                        this.loadCapabilities();
                    };
                    
                    this.eventSource.onerror = (error) => {
                        clearTimeout(connectionTimeout);
                        addLog('error', `EventSource error: ${error.message || 'Connection failed'}`);
                        addLog('info', 'This might be due to CORS policy, server unavailability, or network issues');
                        updateStatus('failed', 'Connection failed');
                        if (this.eventSource) {
                            this.eventSource.close();
                            this.eventSource = null;
                        }
                    };
                    
                    this.eventSource.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            this.handleMessage(data);
                        } catch (e) {
                            addLog('warn', `Failed to parse message: ${e.message}`);
                        }
                    };
                    
                } catch (error) {
                    addLog('error', `Connection failed: ${error.message}`);
                    updateStatus('failed', 'Connection failed');
                    throw error;
                }
            }

            async loadCapabilities() {
                // Simulate loading tools, resources, and prompts
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Mock some example tools
                this.tools = [
                    {
                        name: 'calculator',
                        description: 'Perform mathematical calculations',
                        inputSchema: {
                            type: 'object',
                            properties: {
                                expression: {
                                    type: 'string',
                                    description: 'Mathematical expression to evaluate'
                                }
                            },
                            required: ['expression']
                        }
                    },
                    {
                        name: 'weather',
                        description: 'Get weather information for a location',
                        inputSchema: {
                            type: 'object',
                            properties: {
                                location: {
                                    type: 'string',
                                    description: 'City name or coordinates'
                                },
                                units: {
                                    type: 'string',
                                    description: 'Temperature units (celsius/fahrenheit)',
                                    default: 'celsius'
                                }
                            },
                            required: ['location']
                        }
                    }
                ];

                // Mock some example resources
                this.resources = [
                    {
                        uri: 'file://docs/readme.md',
                        name: 'README Documentation',
                        description: 'Project documentation and setup instructions',
                        mimeType: 'text/markdown'
                    },
                    {
                        uri: 'api://config/settings',
                        name: 'Configuration Settings',
                        description: 'Current server configuration parameters',
                        mimeType: 'application/json'
                    }
                ];

                // Mock some example prompts
                this.prompts = [
                    {
                        name: 'summarize',
                        description: 'Create a summary of provided text',
                        arguments: [
                            {
                                name: 'text',
                                description: 'Text to summarize',
                                required: true
                            },
                            {
                                name: 'length',
                                description: 'Desired summary length',
                                required: false
                            }
                        ]
                    }
                ];

                updateStatus('ready', 'Connected and ready');
                this.renderTools();
                this.renderResources();
                this.renderPrompts();
            }

            handleMessage(data) {
                addLog('debug', `Received message: ${JSON.stringify(data)}`);
            }

            async callTool(name, args = {}) {
                addLog('info', `Calling tool: ${name} with args: ${JSON.stringify(args)}`);
                
                // Simulate tool execution delay
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Mock tool responses
                if (name === 'calculator') {
                    try {
                        const result = eval(args.expression); // Note: eval is unsafe, this is just for demo
                        return { result: result };
                    } catch (e) {
                        throw new Error(`Invalid expression: ${e.message}`);
                    }
                } else if (name === 'weather') {
                    return {
                        location: args.location,
                        temperature: Math.round(Math.random() * 30 + 10),
                        units: args.units || 'celsius',
                        conditions: 'Partly cloudy'
                    };
                }
                
                return { message: `Tool ${name} executed successfully` };
            }

            async readResource(uri) {
                addLog('info', `Reading resource: ${uri}`);
                await new Promise(resolve => setTimeout(resolve, 300));
                
                if (uri.includes('readme.md')) {
                    return {
                        contents: [{
                            type: 'text',
                            text: '# MCP Server\n\nThis is a sample MCP server that provides various tools and resources.\n\n## Features\n- Calculator tool\n- Weather information\n- Resource access'
                        }]
                    };
                } else if (uri.includes('settings')) {
                    return {
                        contents: [{
                            type: 'text',
                            text: JSON.stringify({
                                server: 'MCP Demo Server',
                                version: '1.0.0',
                                capabilities: ['tools', 'resources', 'prompts']
                            }, null, 2)
                        }]
                    };
                }
                
                return {
                    contents: [{
                        type: 'text',
                        text: 'Resource content not available in demo mode'
                    }]
                };
            }

            disconnect() {
                if (this.eventSource) {
                    this.eventSource.close();
                    this.eventSource = null;
                }
                updateStatus('disconnected', 'Disconnected');
                this.clearUI();
            }

            renderTools() {
                const container = document.getElementById('tools-content');
                if (this.tools.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No Tools Available</h3>
                            <p>This server doesn't provide any tools</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `<div class="tool-grid"></div>`;
                const grid = container.querySelector('.tool-grid');

                this.tools.forEach(tool => {
                    const toolCard = document.createElement('div');
                    toolCard.className = 'tool-card';
                    
                    let inputsHtml = '';
                    if (tool.inputSchema && tool.inputSchema.properties) {
                        Object.entries(tool.inputSchema.properties).forEach(([key, prop]) => {
                            inputsHtml += `
                                <div class="tool-input">
                                    <label>${key}${tool.inputSchema.required?.includes(key) ? ' *' : ''}</label>
                                    <input type="text" data-param="${key}" placeholder="${prop.description || key}">
                                </div>
                            `;
                        });
                    }

                    toolCard.innerHTML = `
                        <div class="tool-header">
                            <div class="tool-name">${tool.name}</div>
                        </div>
                        <div class="tool-description">${tool.description}</div>
                        <div class="tool-inputs">
                            ${inputsHtml}
                        </div>
                        <button class="execute-btn" onclick="executeTool('${tool.name}', this)">
                            Execute Tool
                        </button>
                        <div class="result-area" style="display: none;"></div>
                    `;
                    
                    grid.appendChild(toolCard);
                });
            }

            renderResources() {
                const container = document.getElementById('resources-content');
                if (this.resources.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No Resources Available</h3>
                            <p>This server doesn't provide any resources</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = '<div class="resource-list"></div>';
                const list = container.querySelector('.resource-list');

                this.resources.forEach(resource => {
                    const resourceItem = document.createElement('div');
                    resourceItem.className = 'resource-item';
                    resourceItem.innerHTML = `
                        <div class="resource-uri">${resource.uri}</div>
                        <div class="resource-description">${resource.description}</div>
                        <button class="read-resource-btn" onclick="readResource('${resource.uri}', this)">
                            Read Resource
                        </button>
                        <div class="result-area" style="display: none; margin-top: 12px;"></div>
                    `;
                    list.appendChild(resourceItem);
                });
            }

            renderPrompts() {
                const container = document.getElementById('prompts-content');
                if (this.prompts.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No Prompts Available</h3>
                            <p>This server doesn't provide any prompts</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = '<div class="tool-grid"></div>';
                const grid = container.querySelector('.tool-grid');

                this.prompts.forEach(prompt => {
                    const promptCard = document.createElement('div');
                    promptCard.className = 'tool-card';
                    
                    let inputsHtml = '';
                    if (prompt.arguments) {
                        prompt.arguments.forEach(arg => {
                            inputsHtml += `
                                <div class="tool-input">
                                    <label>${arg.name}${arg.required ? ' *' : ''}</label>
                                    <input type="text" data-param="${arg.name}" placeholder="${arg.description || arg.name}">
                                </div>
                            `;
                        });
                    }

                    promptCard.innerHTML = `
                        <div class="tool-header">
                            <div class="tool-name">${prompt.name}</div>
                        </div>
                        <div class="tool-description">${prompt.description}</div>
                        <div class="tool-inputs">
                            ${inputsHtml}
                        </div>
                        <button class="execute-btn" onclick="executePrompt('${prompt.name}', this)">
                            Get Prompt
                        </button>
                        <div class="result-area" style="display: none;"></div>
                    `;
                    
                    grid.appendChild(promptCard);
                });
            }

            clearUI() {
                ['tools-content', 'resources-content', 'prompts-content'].forEach(id => {
                    document.getElementById(id).innerHTML = `
                        <div class="empty-state">
                            <h3>No ${id.split('-')[0]} Available</h3>
                            <p>Connect to an MCP server to see available ${id.split('-')[0]}</p>
                        </div>
                    `;
                });
            }
        }

        // Global functions for UI interactions
        async function connectToServer() {
            const url = document.getElementById('serverUrl').value;
            const clientName = document.getElementById('clientName').value;
            
            if (!url) {
                addLog('warn', 'Please enter a server URL');
                return;
            }

            try {
                mcpConnection = new MockMCPConnection(url, { clientName });
                await mcpConnection.connect();
            } catch (error) {
                addLog('error', `Failed to connect: ${error.message}`);
                updateStatus('failed', 'Connection failed');
            }
        }

        function disconnectFromServer() {
            if (mcpConnection) {
                mcpConnection.disconnect();
                mcpConnection = null;
            }
        }

        async function executeTool(toolName, button) {
            if (!mcpConnection) {
                addLog('warn', 'Not connected to server');
                return;
            }

            const toolCard = button.parentElement;
            const inputs = toolCard.querySelectorAll('.tool-input input');
            const args = {};
            
            inputs.forEach(input => {
                const param = input.dataset.param;
                if (input.value) {
                    args[param] = input.value;
                }
            });

            const resultArea = toolCard.querySelector('.result-area');
            resultArea.style.display = 'block';
            resultArea.textContent = 'Executing...';
            
            try {
                const result = await mcpConnection.callTool(toolName, args);
                resultArea.textContent = JSON.stringify(result, null, 2);
                addLog('info', `Tool ${toolName} executed successfully`);
            } catch (error) {
                resultArea.textContent = `Error: ${error.message}`;
                addLog('error', `Tool execution failed: ${error.message}`);
            }
        }

        async function readResource(uri, button) {
            if (!mcpConnection) {
                addLog('warn', 'Not connected to server');
                return;
            }

            const resourceItem = button.parentElement;
            const resultArea = resourceItem.querySelector('.result-area');
            resultArea.style.display = 'block';
            resultArea.textContent = 'Reading resource...';
            
            try {
                const result = await mcpConnection.readResource(uri);
                const content = result.contents[0]?.text || 'No content available';
                resultArea.textContent = content;
                addLog('info', `Resource ${uri} read successfully`);
            } catch (error) {
                resultArea.textContent = `Error: ${error.message}`;
                addLog('error', `Resource read failed: ${error.message}`);
            }
        }

        async function executePrompt(promptName, button) {
            if (!mcpConnection) {
                addLog('warn', 'Not connected to server');
                return;
            }

            const promptCard = button.parentElement;
            const inputs = promptCard.querySelectorAll('.tool-input input');
            const args = {};
            
            inputs.forEach(input => {
                const param = input.dataset.param;
                if (input.value) {
                    args[param] = input.value;
                }
            });

            const resultArea = promptCard.querySelector('.result-area');
            resultArea.style.display = 'block';
            resultArea.textContent = 'Getting prompt...';
            
            try {
                // Mock prompt response
                const response = {
                    messages: [
                        {
                            role: 'user',
                            content: {
                                type: 'text',
                                text: `Please help me with: ${Object.values(args).join(', ')}`
                            }
                        }
                    ]
                };
                resultArea.textContent = JSON.stringify(response, null, 2);
                addLog('info', `Prompt ${promptName} retrieved successfully`);
            } catch (error) {
                resultArea.textContent = `Error: ${error.message}`;
                addLog('error', `Prompt execution failed: ${error.message}`);
            }
        }

        // Initialize the application
        addLog('info', 'MCP Host application initialized');
        addLog('info', 'Enter a server URL and click Connect to get started');
    </script>
</body>
</html>
